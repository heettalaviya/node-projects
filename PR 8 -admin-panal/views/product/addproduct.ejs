<%- include('../header')%>

<div class="page-wrapper" style="background: #f4f7f6; min-height: 100vh;">
    <div class="page-breadcrumb">
        <div class="row">
            <div class="col-12 d-flex no-block align-items-center">
                <h4 class="page-title text-dark">Add New Product</h4>
                <div class="ml-auto text-right">
                    <nav aria-label="breadcrumb">
                        <ol class="breadcrumb" style="background: transparent;">
                            <li class="breadcrumb-item"><a href="#" class="text-muted">Home</a></li>
                            <li class="breadcrumb-item active" aria-current="page">Catalog</li>
                        </ol>
                    </nav>
                </div>
            </div>
        </div>
    </div>

    <div class="container-fluid">
        <div class="row justify-content-center">
            <div class="col-lg-10">
                <div class="card shadow-sm border-0" style="border-radius: 12px;">
                    <form action="/product/add-product" method="post" enctype="multipart/form-data">
                        <div class="card-body p-4">
                            <div class="row">
                                <div class="col-md-5 border-right">
                                    <h5 class="card-title text-primary mb-4"><i class="mdi mdi-layers mr-2"></i>Hierarchy</h5>
                                    
                                    <div class="form-group mb-3">
                                        <label class="font-weight-bold small text-uppercase text-muted">Main Category</label>
                                        <select name="categoryId" id="categoryId" class="form-control custom-select shadow-none">
                                            <option value="">Select category</option>
                                            <% category.forEach((category)=>{ %>
                                                <option value="<%= category.id %>"><%= category.categoryName %></option>
                                            <% }) %>
                                        </select>
                                    </div>

                                    <div class="form-group mb-3">
                                        <label class="font-weight-bold small text-uppercase text-muted">Sub Category</label>
                                        <select name="subcategoryId" id="subcategoryId" class="form-control custom-select shadow-none">
                                            <option value="">Select sub category</option>
                                        </select>
                                    </div>

                                    <div class="form-group mb-3">
                                        <label class="font-weight-bold small text-uppercase text-muted">Extra Sub Category</label>
                                        <select name="extrasubcategoryId" id="extrasubcategoryId" class="form-control custom-select shadow-none">
                                            <option value="">Select extra sub category</option>
                                        </select>
                                    </div>

                                    <div class="mt-4 p-3 bg-light rounded text-center">
                                        <label class="d-block text-muted mb-2">Product Image Preview</label>
                                        <img id="imgPreview" src="https://via.placeholder.com/150" class="img-fluid rounded shadow-sm" style="max-height: 180px; width: auto;">
                                        <div class="custom-file mt-3">
                                            <input type="file" class="custom-file-input" id="productImage" name="productImage" onchange="previewImage(event)" required>
                                            <label class="custom-file-label text-left" for="productImage">Choose file...</label>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-md-7 px-md-4">
                                    <h5 class="card-title text-primary mb-4"><i class="mdi mdi-barcode-scan mr-2"></i>Product Details</h5>
                                    
                                    <div class="form-group mb-3">
                                        <label class="font-weight-bold">Product Name</label>
                                        <input type="text" class="form-control form-control-lg" placeholder="e.g. iPhone 15 Pro Max" name="productName" required>
                                    </div>

                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="form-group mb-3">
                                                <label class="font-weight-bold">Brand</label>
                                                <input type="text" class="form-control" placeholder="Apple" name="ProductBrand">
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="form-group mb-3">
                                                <label class="font-weight-bold">Price ($)</label>
                                                <input type="number" class="form-control" placeholder="0.00" name="productPrice" step="0.01">
                                            </div>
                                        </div>
                                    </div>

                                    <div class="form-group mb-3">
                                        <label class="font-weight-bold">Product Description</label>
                                        <textarea class="form-control" rows="5" placeholder="Enter detailed product features..." name="productDes" style="resize: none;"></textarea>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="card-footer bg-light p-4 text-right" style="border-radius: 0 0 12px 12px;">
                            <button type="reset" class="btn btn-outline-secondary px-4 mr-2">Reset Form</button>
                            <button type="submit" class="btn btn-primary btn-lg px-5 shadow-sm" style="border-radius: 8px;">
                                <i class="mdi mdi-check mr-1"></i> Save Product
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .custom-select:focus, .form-control:focus {
        border-color: #7460ee;
        box-shadow: 0 0 0 0.2rem rgba(116, 96, 238, 0.1);
    }
    .card-title { font-size: 1.1rem; letter-spacing: 0.5px; }
    .border-right { border-right: 1px solid #ebedf2 !important; }
    @media (max-width: 768px) { .border-right { border-right: none !important; border-bottom: 1px solid #ebedf2 !important; margin-bottom: 20px; } }
</style>

<script>
    const categoryId = document.getElementById('categoryId');
    const subcategoryId = document.getElementById('subcategoryId');
    const extrasubcategoryId = document.getElementById('extrasubcategoryId');

    // Handle Sub-Category Load
    categoryId.addEventListener('change', () => {
        let id = categoryId.value;
        subcategoryId.innerHTML = `<option value="">Loading...</option>`;
        extrasubcategoryId.innerHTML = `<option value="">Select extra sub category</option>`;

        fetch(`/extrasubcategory/subcategory/${id}`)
            .then(res => res.json())
            .then(data => {
                subcategoryId.innerHTML = `<option value="">Select sub category</option>`;
                data.data.forEach(res => {
                    let option = document.createElement('option');
                    option.textContent = res.subCategoryName;
                    option.value = res._id;
                    subcategoryId.append(option);
                });
            });
    });

    // Handle Extra Sub-Category Load
    subcategoryId.addEventListener('change', () => {
        let id = subcategoryId.value;
        extrasubcategoryId.innerHTML = `<option value="">Loading...</option>`;

        fetch(`/product/extrasubcategory/${id}`)
            .then(res => res.json())
            .then(data => {
                extrasubcategoryId.innerHTML = `<option value="">Select extra sub category</option>`;
                data.data.forEach(res => {
                    let option = document.createElement('option');
                    option.textContent = res.extrasubCategoryName;
                    option.value = res._id;
                    extrasubcategoryId.append(option);
                });
            });
    });

    // Image Preview Utility
    function previewImage(event) {
        const reader = new FileReader();
        reader.onload = function(){
            const output = document.getElementById('imgPreview');
            output.src = reader.result;
        };
        reader.readAsDataURL(event.target.files[0]);
    }
</script>

<%- include('../footer')%>