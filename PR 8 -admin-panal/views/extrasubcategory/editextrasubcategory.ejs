<%- include('../header')%>

<div class="page-wrapper" style="background: #f4f7f6; min-height: 100vh;">
    <div class="page-breadcrumb">
        <div class="row">
            <div class="col-12 d-flex no-block align-items-center">
                <h4 class="page-title text-dark">Update Extra Sub Category</h4>
                <div class="ml-auto text-right">
                    <nav aria-label="breadcrumb">
                        <ol class="breadcrumb" style="background: transparent;">
                            <li class="breadcrumb-item"><a href="#" class="text-muted">Home</a></li>
                            <li class="breadcrumb-item active" aria-current="page">Extra Sub</li>
                        </ol>
                    </nav>
                </div>
            </div>
        </div>
    </div>

    <div class="container-fluid">
        <div class="row justify-content-center">
            <div class="col-md-8 col-lg-6">
                <div class="card shadow border-0" style="border-radius: 15px;">
                    <div class="card-header bg-white py-3 border-bottom">
                        <div class="d-flex align-items-center">
                            <div class="bg-cyan text-white p-2 rounded mr-3 shadow-sm">
                                <i class="mdi mdi-settings font-20"></i>
                            </div>
                            <div>
                                <h5 class="m-0 font-weight-bold">Configuration</h5>
                                <small class="text-muted">Adjust hierarchy and naming</small>
                            </div>
                        </div>
                    </div>

                    <form action="/extrasubcategory/update-extrasubcategory/<%= extrasubcategory.id %>" method="post">
                        <div class="card-body px-4 py-4">
                            
                            <div class="form-group mb-4">
                                <label class="text-dark font-weight-bold mb-2">1. Select Category</label>
                                <div class="input-group">
                                    <div class="input-group-prepend">
                                        <span class="input-group-text bg-white border-right-0"><i class="mdi mdi-folder-outline text-primary"></i></span>
                                    </div>
                                    <select name="categoryId" class="form-control border-left-0 custom-select" id="categoryId" style="height: 48px;">
                                        <option value="">Choose Category...</option>
                                        <% category.forEach((category)=>{ %>
                                            <option value="<%= category.id %>" <%= category.id == extrasubcategory.categoryId ? 'selected' : '' %>>
                                                <%= category.categoryName %>
                                            </option>
                                        <% }) %>
                                    </select>
                                </div>
                            </div>

                            <div class="form-group mb-4">
                                <label class="text-dark font-weight-bold mb-2">2. Select Sub Category</label>
                                <div class="input-group">
                                    <div class="input-group-prepend">
                                        <span class="input-group-text bg-white border-right-0"><i class="mdi mdi-subdirectory-arrow-right text-success"></i></span>
                                    </div>
                                    <select name="subcategoryId" class="form-control border-left-0 custom-select" id="subcategoryId" style="height: 48px;">
                                        <option value="">Choose Sub Category...</option>
                                    </select>
                                </div>
                            </div>

                            <div class="form-group mb-4">
                                <label class="text-dark font-weight-bold mb-2">3. Extra Sub Category Name</label>
                                <div class="input-group shadow-sm" style="border-radius: 8px; overflow: hidden;">
                                    <input type="text" class="form-control border-0" id="extrasubCategoryName"
                                           placeholder="e.g. Gaming Laptops" name="extrasubCategoryName"
                                           value="<%= extrasubcategory.extrasubCategoryName %>" style="height: 50px;">
                                    <div class="input-group-append">
                                        <span class="input-group-text bg-white border-0"><i class="mdi mdi-pencil text-muted"></i></span>
                                    </div>
                                </div>
                            </div>

                        </div>

                        <div class="card-footer bg-light d-flex justify-content-between py-3">
                            <button type="button" onclick="history.back()" class="btn btn-outline-secondary px-4">Cancel</button>
                            <button type="submit" class="btn btn-cyan text-white px-5 font-weight-bold shadow">
                                <i class="mdi mdi-content-save mr-1"></i> Update Record
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .bg-cyan { background-color: #27a9e3; }
    .btn-cyan { background-color: #27a9e3; border-color: #27a9e3; }
    .btn-cyan:hover { background-color: #2297cc; opacity: 0.9; }
    .form-control:focus {
        border-color: #27a9e3;
        box-shadow: none;
    }
    .input-group-text { border: 1px solid #ced4da; }
    label { font-size: 0.9rem; letter-spacing: 0.3px; }
</style>

<script>
    let categoryId = document.getElementById('categoryId');
    let subcategoryId = document.getElementById('subcategoryId');
    let selectedSubCategory = "<%= extrasubcategory.subcategoryId %>";

    function loadSubCategories(catId, selectedId = null) {
        subcategoryId.innerHTML = `<option value="">select sub category</option>`;
        if(!catId) return;

        fetch(`/extrasubcategory/subcategory/${catId}`)
            .then(res => res.json())
            .then(data => {
                data.data.forEach(subcat => {
                    let option = document.createElement('option');
                    option.value = subcat._id;
                    option.textContent = subcat.subCategoryName;
                    if (subcat._id == selectedId) option.selected = true;
                    subcategoryId.appendChild(option);
                });
            });
    }

    if (categoryId.value) {
        loadSubCategories(categoryId.value, selectedSubCategory);
    }

    categoryId.addEventListener('change', () => {
        loadSubCategories(categoryId.value);
    });
</script>

<%- include('../footer')%>